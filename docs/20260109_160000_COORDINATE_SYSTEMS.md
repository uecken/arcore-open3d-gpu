# ARCore vs COLMAP åº§æ¨™ç³»ã‚¬ã‚¤ãƒ‰

**ä½œæˆæ—¥æ™‚:** 2026-01-09 16:00:00  
**æ›´æ–°æ—¥æ™‚:** 2026-01-09 16:00:00  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:** å®Ÿè£…å®Œäº†

---

## æ¦‚è¦

ARCoreã¨COLMAPã¯ç•°ãªã‚‹åº§æ¨™ç³»ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã™ã‚‹éš›ã«ã¯å¤‰æ›ãŒå¿…è¦ã§ã™ã€‚
æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯åº§æ¨™ç³»ã®é•ã„ã€å¤‰æ›æ–¹æ³•ã€ãŠã‚ˆã³å®Ÿè£…æ¸ˆã¿ã®ä½ç½®åˆã‚ã›æ–¹å¼ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

---

## å®Ÿè£…æ¸ˆã¿æ–¹å¼ä¸€è¦§

| æ–¹å¼ | æ¦‚è¦ | ä½ç½®ç²¾åº¦ | å›è»¢ç²¾åº¦ | ãƒ¡ãƒƒã‚·ãƒ¥å“è³ª | config.yamlè¨­å®š |
|------|------|---------|---------|-------------|----------------|
| **æ–¹å¼2** | pose_prior_mapper | 0.55m | 55Â° | âœ… ç¶ºéº— | `use_pose_priors: true` |
| **æ–¹å¼3** | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè£œæ­£ | 0.14m | 55Â° | è‹¥å¹²æ­ªã¿ | `use_pose_priors: false` |
| **æ–¹å¼3æ”¹è‰¯** | æ–¹å¼3 + ARCoreå›è»¢ | **0.14m** | **â‰ˆ2Â°** | è‹¥å¹²æ­ªã¿ | `use_arcore_rotation: true` |

---

## å‡¦ç†ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

### å…¨ä½“ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Androidç«¯æœ«                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ RGBç”»åƒæ’®å½±  â”‚    â”‚ ARCore VIO  â”‚    â”‚ Depthå–å¾—   â”‚    â”‚ RFIDæ¤œå‡º     â”‚â”‚
â”‚   â”‚ (*.jpg)     â”‚    â”‚ (pose)      â”‚    â”‚ (*.raw)     â”‚    â”‚ (rssi,æ™‚åˆ»)  â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                  â”‚                  â”‚                   â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                             â”‚                  â”‚                            â”‚
â”‚                             â–¼                  â–¼                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚          HTTP POST Upload          â”‚                   â”‚
â”‚                    â”‚    /api/v1/sessions/upload         â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ã‚µãƒ¼ãƒãƒ¼ (FastAPI)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    COLMAP MVS ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³                           â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. Feature Extractor    â”€â†’ ç‰¹å¾´ç‚¹æŠ½å‡º (GPU)                        â”‚   â”‚
â”‚   â”‚  2. Matcher              â”€â†’ ç‰¹å¾´ç‚¹ãƒãƒƒãƒãƒ³ã‚° (GPU)                  â”‚   â”‚
â”‚   â”‚  ã€æ–¹å¼2ã€‘pose_prior_mapper â”€â†’ ARCoreæ‹˜æŸä»˜ãSfM                    â”‚   â”‚
â”‚   â”‚  ã€æ–¹å¼3ã€‘mapper           â”€â†’ é€šå¸¸SfM                               â”‚   â”‚
â”‚   â”‚  4. Image Undistorter    â”€â†’ æ­ªã¿è£œæ­£                                â”‚   â”‚
â”‚   â”‚  5. Patch Match Stereo   â”€â†’ å¯†ãªæ·±åº¦ãƒãƒƒãƒ—ç”Ÿæˆ (GPU)                â”‚   â”‚
â”‚   â”‚  6. Stereo Fusion        â”€â†’ ç‚¹ç¾¤ç”Ÿæˆ (COLMAPåº§æ¨™ç³»)                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    åº§æ¨™å¤‰æ› (COLMAP â†’ ARCore)                        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã§ARCore/COLMAPãƒãƒ¼ã‚ºã‚’ç´ã¥ã‘                     â”‚   â”‚
â”‚   â”‚  2. Procrustesåˆ†æã§å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨ˆç®—                              â”‚   â”‚
â”‚   â”‚     - scale: ~0.1-0.4                                              â”‚   â”‚
â”‚   â”‚     - rotation: 3x3å›è»¢è¡Œåˆ—                                         â”‚   â”‚
â”‚   â”‚     - translation: é‡å¿ƒã‚ªãƒ•ã‚»ãƒƒãƒˆ                                   â”‚   â”‚
â”‚   â”‚  3. ç‚¹ç¾¤/ãƒ¡ãƒƒã‚·ãƒ¥ã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›                               â”‚   â”‚
â”‚   â”‚  ã€æ–¹å¼3æ”¹è‰¯ã€‘ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å±€æ‰€è£œæ­£ + ARCoreå›è»¢ä½¿ç”¨                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    å‡ºåŠ› (results/{job_id}/)                          â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ point_cloud.ply     # ç‚¹ç¾¤ (ARCoreåº§æ¨™ç³»)                      â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ mesh.ply            # ãƒ¡ãƒƒã‚·ãƒ¥ (ARCoreåº§æ¨™ç³»)                  â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ trajectory.json     # ã‚«ãƒ¡ãƒ©è»Œè·¡ (ARCoreåº§æ¨™ç³», å›è»¢ä»˜ã)      â”‚   â”‚
â”‚   â”‚  â””â”€â”€ colmap_to_arcore_transform.json  # å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mermaid ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```mermaid
flowchart TB
    subgraph Android["ğŸ“± Androidç«¯æœ«"]
        A1[RGBç”»åƒæ’®å½±<br/>*.jpg]
        A2[ARCore VIO<br/>ã‚«ãƒ¡ãƒ©ãƒãƒ¼ã‚º]
        A3[Depthå–å¾—<br/>*.raw]
        A4[RFIDæ¤œå‡º<br/>rssi, æ™‚åˆ»]
    end

    subgraph Upload["ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"]
        U1[HTTP POST<br/>/api/v1/sessions/upload]
    end

    subgraph Server["ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼"]
        subgraph COLMAP["âš™ï¸ COLMAP"]
            C1[Feature Extractor]
            C2[Matcher]
            C3{use_pose_priors?}
            C3a[pose_prior_mapper<br/>æ–¹å¼2]
            C3b[mapper<br/>æ–¹å¼3]
            C4[Patch Match Stereo]
            C5[Stereo Fusion]
        end

        subgraph Transform["ğŸ”„ åº§æ¨™å¤‰æ›"]
            T1[Procrustesåˆ†æ]
            T2{æ–¹å¼3æ”¹è‰¯?}
            T2a[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè£œæ­£<br/>+ ARCoreå›è»¢]
            T2b[å…¨ä½“å¤‰æ›ã®ã¿]
        end

        subgraph Output["ğŸ“ å‡ºåŠ›"]
            O1[mesh.ply<br/>ARCoreåº§æ¨™ç³»]
            O2[trajectory.json<br/>å›è»¢ä»˜ã]
        end
    end

    A1 --> U1
    A2 --> U1
    U1 --> C1
    C1 --> C2
    C2 --> C3
    C3 -->|true| C3a
    C3 -->|false| C3b
    C3a --> C4
    C3b --> C4
    C4 --> C5
    C5 --> T1
    T1 --> T2
    T2 -->|true| T2a
    T2 -->|false| T2b
    T2a --> O1
    T2b --> O1
    A2 --> O2

    style Android fill:#e1f5fe
    style Server fill:#fff3e0
    style COLMAP fill:#ffecb3
    style Transform fill:#f3e5f5
```

---

## 1. ARCoreåº§æ¨™ç³»

### ç‰¹å¾´
- **åŸç‚¹**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ãƒ‡ãƒã‚¤ã‚¹ä½ç½®
- **Yè»¸**: é‡åŠ›æ–¹å‘ã®é€†ï¼ˆä¸Šå‘ãï¼‰
- **Xè»¸**: ãƒ‡ãƒã‚¤ã‚¹ã®å³æ–¹å‘
- **Zè»¸**: ãƒ‡ãƒã‚¤ã‚¹ã®å¾Œã‚æ–¹å‘ï¼ˆã‚«ãƒ¡ãƒ©ãŒå‘ã„ã¦ã„ã‚‹æ–¹å‘ã®é€†ï¼‰
- **å˜ä½**: ãƒ¡ãƒ¼ãƒˆãƒ«
- **å³æ‰‹åº§æ¨™ç³»**

### ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³å½¢å¼
- **å†…éƒ¨å½¢å¼**: `[qw, qx, qy, qz]` ï¼ˆCameraPose.quaternionï¼‰
- **ä¿å­˜å½¢å¼**: `[qx, qy, qz, qw]` ï¼ˆtrajectory.jsonã€scipy/Three.jsæ¨™æº–ï¼‰

```python
# CameraPose.quaternion ã¯ [qw, qx, qy, qz]
quat = frame.pose.quaternion
# [qx, qy, qz, qw] ã«å¤‰æ›ã—ã¦ä¿å­˜
quat_xyzw = [quat[1], quat[2], quat[3], quat[0]]
```

### è‡ªå·±ä½ç½®æ¨å®šæ–¹å¼
- **VIO (Visual-Inertial Odometry)**: ã‚«ãƒ¡ãƒ©ç”»åƒ + IMU
- **ç²¾åº¦**: ä½ç½® ~æ•°cmã€å›è»¢ ~1-3Â°

---

## 2. COLMAPåº§æ¨™ç³»

### ç‰¹å¾´
- **åŸç‚¹**: ä»»æ„ï¼ˆæœ€é©åŒ–çµæœã«ã‚ˆã‚‹ï¼‰
- **è»¸æ–¹å‘**: é‡åŠ›æ–¹å‘ã¨ã®é–¢ä¿‚ã¯ä¿è¨¼ã•ã‚Œãªã„
- **ã‚¹ã‚±ãƒ¼ãƒ«**: ç›¸å¯¾ã‚¹ã‚±ãƒ¼ãƒ«ã®ã¿ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«å˜ä½ã§ã¯ãªã„ï¼‰

### è‡ªå·±ä½ç½®æ¨å®šæ–¹å¼
- **SfM (Structure from Motion)**: ç”»åƒã®ã¿ã‹ã‚‰æ¨å®š
- **ç²¾åº¦**: ç›¸å¯¾ä½ç½®ã¯é«˜ç²¾åº¦ã€çµ¶å¯¾ä½ç½®ã¯ä¸æ˜

---

## 3. åº§æ¨™å¤‰æ›ã®å®Ÿè£…

### Procrustesåˆ†æ

```python
def _compute_colmap_to_arcore_transform(parser, colmap_dir):
    # 1. ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã§å¯¾å¿œç‚¹ã‚’å–å¾—
    arcore_pts = []  # ARCoreã‚«ãƒ¡ãƒ©ä½ç½®
    colmap_pts = []  # COLMAPã‚«ãƒ¡ãƒ©ä½ç½®
    
    # 2. ä¸­å¿ƒåŒ–
    arcore_centroid = arcore_pts.mean(axis=0)
    colmap_centroid = colmap_pts.mean(axis=0)
    
    # 3. ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
    scale = arcore_scale / colmap_scale
    
    # 4. æœ€é©å›è»¢è¡Œåˆ—
    R, _ = orthogonal_procrustes(colmap_normalized, arcore_normalized)
    
    return {'scale': scale, 'rotation': R, ...}
```

### ç‚¹ç¾¤å¤‰æ›

```python
def _transform_points_to_arcore(points, transform):
    """COLMAPåº§æ¨™ç³» â†’ ARCoreåº§æ¨™ç³»"""
    # p_arcore = scale Ã— R Ã— (p_colmap - centroid_colmap) + centroid_arcore
    centered = points - transform['colmap_centroid']
    transformed = transform['scale'] * (centered @ transform['rotation']) + transform['arcore_centroid']
    return transformed
```

---

## 4. æ–¹å¼åˆ¥ã®å®Ÿè£…è©³ç´°

### æ–¹å¼2: pose_prior_mapper

ARCoreãƒãƒ¼ã‚ºã‚’**ã‚½ãƒ•ãƒˆæ‹˜æŸ**ã¨ã—ã¦COLMAP SfMã«æä¾›ã€‚

```yaml
# config.yaml
colmap:
  use_pose_priors: true
  pose_prior:
    position_std_x: 0.1  # 10cm
    position_std_y: 0.1
    position_std_z: 0.1
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. ARCoreãƒãƒ¼ã‚ºã‚’COLMAPåº§æ¨™ç³»ã«å¤‰æ›ï¼ˆY, Zåè»¢ï¼‰
2. `pose_priors`ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥
3. `pose_prior_mapper`ã§SfMå®Ÿè¡Œ
4. Procrustesåˆ†æã§åº§æ¨™å¤‰æ›

**é•·æ‰€:** ãƒ¡ãƒƒã‚·ãƒ¥ãŒç¶ºéº—ï¼ˆæ­ªã¿ãªã—ï¼‰
**çŸ­æ‰€:** ä½ç½®ç²¾åº¦0.55mã€ã‚¹ã‚±ãƒ¼ãƒ«æ¯”1.69x

### æ–¹å¼3: é€šå¸¸SfM + ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè£œæ­£

```yaml
# config.yaml
colmap:
  use_pose_priors: false
alignment:
  segment_correction:
    enable: true
    segment_duration_sec: 2.0
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. é€šå¸¸ã®COLMAP SfMã‚’å®Ÿè¡Œ
2. Procrustesåˆ†æã§å…¨ä½“å¤‰æ›
3. 2ç§’ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã«å±€æ‰€ä¸¦é€²è£œæ­£

**é•·æ‰€:** ä½ç½®ç²¾åº¦0.14m
**çŸ­æ‰€:** ãƒ¡ãƒƒã‚·ãƒ¥ã«è‹¥å¹²ã®æ­ªã¿

### æ–¹å¼3æ”¹è‰¯: ARCoreå›è»¢ä½¿ç”¨

```yaml
# config.yaml
alignment:
  use_arcore_rotation: true
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼:**
1. æ–¹å¼3ã®å‡¦ç†ã‚’å®Ÿè¡Œ
2. è»Œè·¡ã®å›è»¢ã‚’ARCoreå›è»¢ã§ç½®æ›

**é•·æ‰€:** å›è»¢ç²¾åº¦â‰ˆ2Â°ï¼ˆCOLMAP: 55Â°ï¼‰
**çŸ­æ‰€:** ãƒ¡ãƒƒã‚·ãƒ¥ã«è‹¥å¹²ã®æ­ªã¿

---

## 5. è»Œè·¡ãƒ‡ãƒ¼ã‚¿å½¢å¼

### trajectory.json

```json
{
  "poses": [
    {
      "position": {"x": 0.15, "y": 0.21, "z": 0.22},
      "rotation": [0.14, 0.20, 0.21, 0.94],
      "timestamp": 79274840173634
    }
  ],
  "count": 294,
  "coordinate_system": "arcore",
  "rotation_format": "quaternion_xyzw"
}
```

**é‡è¦:** `rotation`ã¯`[qx, qy, qz, qw]`å½¢å¼ï¼ˆscipy/Three.jsæ¨™æº–ï¼‰

### å›è»¢ã®å‰æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«è¨ˆç®—

```python
from scipy.spatial.transform import Rotation as R

quat = pose['rotation']  # [qx, qy, qz, qw]
rot = R.from_quat(quat)
forward = rot.apply([0, 0, -1])  # ã‚«ãƒ¡ãƒ©å‰æ–¹å‘
```

---

## 6. RFIDã‚¿ã‚°ã®åº§æ¨™

### é‡è¦: RFIDã¯å¤‰æ›ä¸è¦

RFIDã‚¿ã‚°ä½ç½®ã¯**æœ€åˆã‹ã‚‰ARCoreåº§æ¨™ç³»**ã§è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

```
ARCore VIO â†’ ã‚«ãƒ¡ãƒ©ä½ç½® (ARCoreåº§æ¨™) â†’ RFIDæ¤œå‡ºä½ç½® (ARCoreåº§æ¨™)
```

### æœ€çµ‚å‡ºåŠ›ï¼ˆã™ã¹ã¦ARCoreåº§æ¨™ç³»ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | åº§æ¨™ç³» | å¤‰æ› |
|----------|--------|------|
| `mesh.ply` | ARCore | COLMAP â†’ ARCoreå¤‰æ›æ¸ˆã¿ |
| `trajectory.json` | ARCore | å…ƒã€…ARCoreåº§æ¨™ |
| `rfid_positions.json` | ARCore | å…ƒã€…ARCoreï¼ˆå¤‰æ›ä¸è¦ï¼‰|

---

## 7. Viewerè¡¨ç¤º

### åº§æ¨™ã‚ªãƒ•ã‚»ãƒƒãƒˆå‡¦ç†

```javascript
// 1. ãƒ¡ãƒƒã‚·ãƒ¥èª­ã¿è¾¼ã¿æ™‚: ä¸­å¿ƒã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—
const boundingBox = new THREE.Box3().setFromObject(mesh);
sceneCenterOffset = boundingBox.getCenter(new THREE.Vector3());
mesh.position.sub(sceneCenterOffset);

// 2. è»Œè·¡/RFIDã«ã‚‚åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨
marker.position.set(
    pose.x - sceneCenterOffset.x,
    pose.y - sceneCenterOffset.y,
    pose.z - sceneCenterOffset.z
);
```

### å‘ãçŸ¢å°ã®è¡¨ç¤º

```javascript
// ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‹ã‚‰å‰æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã‚’è¨ˆç®—
const quaternion = new THREE.Quaternion(q[0], q[1], q[2], q[3]);
const forward = new THREE.Vector3(0, 0, -1).applyQuaternion(quaternion);

// ArrowHelperã§è¡¨ç¤º
const arrow = new THREE.ArrowHelper(forward, position, 0.15, color);
```

---

## 8. å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¾‹

### colmap_to_arcore_transform.json

```json
{
  "scale": 0.1180,
  "rotation": [
    [0.498, 0.107, 0.861],
    [-0.363, -0.876, 0.318],
    [0.788, -0.471, -0.397]
  ],
  "colmap_centroid": [-0.129, -0.074, 0.034],
  "arcore_centroid": [2.083, 0.014, -0.079],
  "mean_error": 0.550,
  "median_error": 0.429
}
```

---

## 9. æ¨å¥¨è¨­å®š

### RFIDã‚¿ã‚°ä½ç½®ç²¾åº¦é‡è¦–

```yaml
colmap:
  use_pose_priors: false
alignment:
  segment_correction:
    enable: true
    segment_duration_sec: 2.0
  use_arcore_rotation: true
```

**çµæœ:** 2må…ˆã®RFIDèª¤å·® â‰ˆ 0.21m

### ãƒ¡ãƒƒã‚·ãƒ¥å“è³ªé‡è¦–

```yaml
colmap:
  use_pose_priors: true
  pose_prior:
    position_std_x: 0.1
    position_std_y: 0.1
    position_std_z: 0.1
```

**çµæœ:** æ­ªã¿ã®ãªã„ç¶ºéº—ãªãƒ¡ãƒƒã‚·ãƒ¥

---

## å‚è€ƒè³‡æ–™

- [ARCore Coordinate System](https://developers.google.com/ar/develop/fundamentals)
- [COLMAP Documentation](https://colmap.github.io/)
- [scipy.spatial.transform.Rotation](https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.transform.Rotation.html)
- [Three.js Quaternion](https://threejs.org/docs/#api/en/math/Quaternion)

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/20260109_130002_ALIGNMENT_METHODS_INVESTIGATION.md` - ä½ç½®åˆã‚ã›æ–¹å¼ã®è©³ç´°èª¿æŸ»
- `docs/20260109_130200_METHOD2_IMPLEMENTATION_PLAN.md` - æ–¹å¼2ã®å®Ÿè£…è¨ˆç”»
- `docs/PIPELINE_COORDINATE_SYSTEM.md` - ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åº§æ¨™ç³»ã®è©³ç´°

---
æœ€çµ‚æ›´æ–°: 2026-01-09 16:00:00

