# ARCore vs COLMAP åº§æ¨™ç³»ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ARCoreã¨COLMAPã¯ç•°ãªã‚‹åº§æ¨™ç³»ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã™ã‚‹éš›ã«ã¯å¤‰æ›ãŒå¿…è¦ã§ã™ã€‚

---

## å‡¦ç†ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

### å…¨ä½“ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Androidç«¯æœ«                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ RGBç”»åƒæ’®å½±  â”‚    â”‚ ARCore VIO  â”‚    â”‚ Depthå–å¾—   â”‚    â”‚ RFIDæ¤œå‡º     â”‚â”‚
â”‚   â”‚ (*.jpg)     â”‚    â”‚ (pose)      â”‚    â”‚ (*.raw)     â”‚    â”‚ (rssi,æ™‚åˆ»)  â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                  â”‚                  â”‚                   â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                             â”‚                  â”‚                            â”‚
â”‚                             â–¼                  â–¼                            â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚          HTTP POST Upload          â”‚                   â”‚
â”‚                    â”‚    /api/v1/sessions/upload         â”‚                   â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ã‚µãƒ¼ãƒãƒ¼ (FastAPI)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    ãƒ‡ãƒ¼ã‚¿ä¿å­˜ (data/sessions/{job_id}/)              â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ images/          # RGBç”»åƒ                                     â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ depth/           # Depthç”»åƒï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰                      â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ ARCore_sensor_pose.txt    # ARCoreãƒãƒ¼ã‚º                       â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ camera_intrinsics.json    # ã‚«ãƒ¡ãƒ©å†…éƒ¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿               â”‚   â”‚
â”‚   â”‚  â””â”€â”€ rfid_detections.json      # RFIDæ¤œå‡ºãƒ‡ãƒ¼ã‚¿                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    COLMAP MVS ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³                           â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. Feature Extractor    â”€â†’ ç‰¹å¾´ç‚¹æŠ½å‡º (GPU)                        â”‚   â”‚
â”‚   â”‚  2. Exhaustive Matcher   â”€â†’ ç‰¹å¾´ç‚¹ãƒãƒƒãƒãƒ³ã‚° (GPU)                  â”‚   â”‚
â”‚   â”‚  3. Mapper (SfM)         â”€â†’ 3Då†æ§‹ç¯‰ãƒ»ã‚«ãƒ¡ãƒ©ä½ç½®æ¨å®š                â”‚   â”‚
â”‚   â”‚  4. Image Undistorter    â”€â†’ æ­ªã¿è£œæ­£                                â”‚   â”‚
â”‚   â”‚  5. Patch Match Stereo   â”€â†’ å¯†ãªæ·±åº¦ãƒãƒƒãƒ—ç”Ÿæˆ (GPU)                â”‚   â”‚
â”‚   â”‚  6. Stereo Fusion        â”€â†’ ç‚¹ç¾¤ç”Ÿæˆ (COLMAPåº§æ¨™ç³»)                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    åº§æ¨™å¤‰æ› (COLMAP â†’ ARCore)                        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã§ARCore/COLMAPãƒãƒ¼ã‚ºã‚’ç´ã¥ã‘                     â”‚   â”‚
â”‚   â”‚  2. Procrustesåˆ†æã§å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨ˆç®—                              â”‚   â”‚
â”‚   â”‚     - scale: ~0.4                                                   â”‚   â”‚
â”‚   â”‚     - rotation: 3x3å›è»¢è¡Œåˆ—                                         â”‚   â”‚
â”‚   â”‚     - translation: é‡å¿ƒã‚ªãƒ•ã‚»ãƒƒãƒˆ                                   â”‚   â”‚
â”‚   â”‚  3. ç‚¹ç¾¤ã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›                                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    å¾Œå‡¦ç†                                            â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. çµ±è¨ˆçš„å¤–ã‚Œå€¤é™¤å» (Statistical Outlier Removal)                  â”‚   â”‚
â”‚   â”‚  2. Poisson Surface Reconstruction (ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ)                   â”‚   â”‚
â”‚   â”‚  3. Laplacianã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°                                           â”‚   â”‚
â”‚   â”‚  4. å°ã•ãªé€£çµæˆåˆ†ã®é™¤å»                                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    å‡ºåŠ› (results/{job_id}/)                          â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ point_cloud.ply     # ç‚¹ç¾¤ (ARCoreåº§æ¨™ç³»)                      â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ mesh.ply            # ãƒ¡ãƒƒã‚·ãƒ¥ (ARCoreåº§æ¨™ç³»)                  â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€ trajectory.json     # ã‚«ãƒ¡ãƒ©è»Œè·¡ (ARCoreåº§æ¨™ç³»)                â”‚   â”‚
â”‚   â”‚  â””â”€â”€ rfid_positions.json # RFIDä½ç½® (ARCoreåº§æ¨™ç³»)                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Webãƒ–ãƒ©ã‚¦ã‚¶ (Viewer)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                    Three.js 3Dãƒ“ãƒ¥ãƒ¼ã‚¢                               â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  1. ãƒ¡ãƒƒã‚·ãƒ¥èª­ã¿è¾¼ã¿ â†’ ä¸­å¿ƒã‚ªãƒ•ã‚»ãƒƒãƒˆè¨ˆç®— (sceneCenterOffset)        â”‚   â”‚
â”‚   â”‚  2. è»Œè·¡èª­ã¿è¾¼ã¿    â†’ åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨                            â”‚   â”‚
â”‚   â”‚  3. RFIDèª­ã¿è¾¼ã¿    â†’ åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆé©ç”¨                            â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚  çµæœ: ã™ã¹ã¦ã‚°ãƒªãƒƒãƒ‰ä¸­å¿ƒã§çµ±ä¸€è¡¨ç¤º                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mermaid ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```mermaid
flowchart TB
    subgraph Android["ğŸ“± Androidç«¯æœ«"]
        A1[RGBç”»åƒæ’®å½±<br/>*.jpg]
        A2[ARCore VIO<br/>ã‚«ãƒ¡ãƒ©ãƒãƒ¼ã‚º]
        A3[Depthå–å¾—<br/>*.raw]
        A4[RFIDæ¤œå‡º<br/>rssi, æ™‚åˆ»]
    end

    subgraph Upload["ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰"]
        U1[HTTP POST<br/>/api/v1/sessions/upload]
    end

    subgraph Server["ğŸ–¥ï¸ ã‚µãƒ¼ãƒãƒ¼ (FastAPI)"]
        subgraph Storage["ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜"]
            S1[images/]
            S2[depth/]
            S3[ARCore_sensor_pose.txt]
            S4[camera_intrinsics.json]
            S5[rfid_detections.json]
        end

        subgraph COLMAP["âš™ï¸ COLMAP MVS"]
            C1[Feature Extractor<br/>ç‰¹å¾´ç‚¹æŠ½å‡º GPU]
            C2[Exhaustive Matcher<br/>ç‰¹å¾´ç‚¹ãƒãƒƒãƒãƒ³ã‚° GPU]
            C3[Mapper SfM<br/>3Då†æ§‹ç¯‰]
            C4[Image Undistorter<br/>æ­ªã¿è£œæ­£]
            C5[Patch Match Stereo<br/>æ·±åº¦ãƒãƒƒãƒ—ç”Ÿæˆ GPU]
            C6[Stereo Fusion<br/>ç‚¹ç¾¤ç”Ÿæˆ]
        end

        subgraph Transform["ğŸ”„ åº§æ¨™å¤‰æ›"]
            T1[ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã§<br/>ãƒãƒ¼ã‚ºç´ã¥ã‘]
            T2[Procrustesåˆ†æ<br/>scale, rotation, translation]
            T3[ç‚¹ç¾¤ã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›]
        end

        subgraph PostProcess["âœ¨ å¾Œå‡¦ç†"]
            P1[å¤–ã‚Œå€¤é™¤å»]
            P2[Poisson Reconstruction<br/>ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ]
            P3[Laplacianã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°]
        end

        subgraph Output["ğŸ“ å‡ºåŠ›"]
            O1[point_cloud.ply]
            O2[mesh.ply]
            O3[trajectory.json]
            O4[rfid_positions.json]
        end
    end

    subgraph Viewer["ğŸŒ Webãƒ–ãƒ©ã‚¦ã‚¶"]
        V1[Three.js 3Dãƒ“ãƒ¥ãƒ¼ã‚¢]
        V2[ãƒ¡ãƒƒã‚·ãƒ¥è¡¨ç¤º]
        V3[è»Œè·¡è¡¨ç¤º]
        V4[RFIDè¡¨ç¤º]
    end

    A1 --> U1
    A2 --> U1
    A3 --> U1
    A4 --> U1

    U1 --> S1
    U1 --> S2
    U1 --> S3
    U1 --> S4
    U1 --> S5

    S1 --> C1
    C1 --> C2
    C2 --> C3
    C3 --> C4
    C4 --> C5
    C5 --> C6

    C6 --> T1
    S3 --> T1
    T1 --> T2
    T2 --> T3

    T3 --> P1
    P1 --> P2
    P2 --> P3

    P3 --> O1
    P3 --> O2
    S3 --> O3
    S5 --> O4

    O1 --> V1
    O2 --> V2
    O3 --> V3
    O4 --> V4

    style Android fill:#e1f5fe
    style Server fill:#fff3e0
    style Viewer fill:#e8f5e9
    style COLMAP fill:#ffecb3
    style Transform fill:#f3e5f5
    style PostProcess fill:#fce4ec
```

### åº§æ¨™å¤‰æ›ã®è©³ç´°ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart LR
    subgraph Input["å…¥åŠ›ãƒ‡ãƒ¼ã‚¿"]
        I1["ARCore Pose<br/>(ARCoreåº§æ¨™ç³»)"]
        I2["COLMAP Pose<br/>(COLMAPåº§æ¨™ç³»)"]
        I3["COLMAPç‚¹ç¾¤<br/>(COLMAPåº§æ¨™ç³»)"]
    end

    subgraph Match["ç´ã¥ã‘"]
        M1["ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã§<br/>ãƒãƒƒãƒãƒ³ã‚°"]
    end

    subgraph Procrustes["Procrustesåˆ†æ"]
        P1["å…±é€šç‚¹ã®æŠ½å‡º"]
        P2["ä¸­å¿ƒåŒ–"]
        P3["ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—<br/>scale â‰ˆ 0.4"]
        P4["å›è»¢è¡Œåˆ—è¨ˆç®—<br/>R = orthogonal_procrustes()"]
    end

    subgraph Apply["å¤‰æ›é©ç”¨"]
        A1["p_arcore = scale Ã— R Ã— <br/>(p_colmap - centroid_colmap)<br/> + centroid_arcore"]
    end

    subgraph Output["å‡ºåŠ›"]
        O1["å¤‰æ›æ¸ˆã¿ç‚¹ç¾¤<br/>(ARCoreåº§æ¨™ç³»)"]
        O2["RFIDä½ç½®<br/>(ARCoreåº§æ¨™ç³»ãƒ»å¤‰æ›ä¸è¦)"]
    end

    I1 --> M1
    I2 --> M1
    M1 --> P1
    P1 --> P2
    P2 --> P3
    P3 --> P4
    P4 --> A1
    I3 --> A1
    A1 --> O1
    O1 -.->|"åŒã˜åº§æ¨™ç³»"| O2

    style Input fill:#e3f2fd
    style Procrustes fill:#fff8e1
    style Apply fill:#f1f8e9
    style Output fill:#fce4ec
```

### RFIDã¨3Dãƒ¢ãƒ‡ãƒ«ã®åº§æ¨™çµ±ä¸€

```mermaid
flowchart TB
    subgraph ARCore["ARCoreåº§æ¨™ç³» (å…ƒãƒ‡ãƒ¼ã‚¿)"]
        AR1["ã‚«ãƒ¡ãƒ©è»Œè·¡<br/>trajectory.json"]
        AR2["RFIDæ¤œå‡ºä½ç½®<br/>rfid_positions.json"]
    end

    subgraph COLMAP["COLMAPåº§æ¨™ç³»"]
        CO1["ç‚¹ç¾¤<br/>fused.ply"]
        CO2["ã‚«ãƒ¡ãƒ©ä½ç½®<br/>images.bin"]
    end

    subgraph Transform["Procrusteså¤‰æ›"]
        TR1["COLMAP â†’ ARCore"]
    end

    subgraph Unified["çµ±ä¸€åº§æ¨™ç³» (ARCore)"]
        UN1["ç‚¹ç¾¤/ãƒ¡ãƒƒã‚·ãƒ¥<br/>âœ… å¤‰æ›æ¸ˆã¿"]
        UN2["è»Œè·¡<br/>âœ… å…ƒã€…ARCore"]
        UN3["RFIDä½ç½®<br/>âœ… å…ƒã€…ARCore"]
    end

    subgraph Viewer["Viewerè¡¨ç¤º"]
        VW1["sceneCenterOffseté©ç”¨"]
        VW2["ã‚°ãƒªãƒƒãƒ‰ä¸­å¿ƒã§çµ±ä¸€è¡¨ç¤º"]
    end

    AR1 --> UN2
    AR2 --> UN3
    CO1 --> TR1
    CO2 --> TR1
    TR1 --> UN1

    UN1 --> VW1
    UN2 --> VW1
    UN3 --> VW1
    VW1 --> VW2

    style ARCore fill:#e8f5e9
    style COLMAP fill:#fff3e0
    style Transform fill:#f3e5f5
    style Unified fill:#e1f5fe
    style Viewer fill:#fce4ec
```

---

## 1. ARCoreåº§æ¨™ç³»

### ç‰¹å¾´
- **åŸç‚¹**: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ãƒ‡ãƒã‚¤ã‚¹ä½ç½®
- **Yè»¸**: é‡åŠ›æ–¹å‘ã®é€†ï¼ˆä¸Šå‘ãï¼‰
- **Xè»¸**: ãƒ‡ãƒã‚¤ã‚¹ã®å³æ–¹å‘
- **Zè»¸**: ãƒ‡ãƒã‚¤ã‚¹ã®å¾Œã‚æ–¹å‘ï¼ˆã‚«ãƒ¡ãƒ©ãŒå‘ã„ã¦ã„ã‚‹æ–¹å‘ã®é€†ï¼‰
- **å˜ä½**: ãƒ¡ãƒ¼ãƒˆãƒ«
- **å³æ‰‹åº§æ¨™ç³»**

### è‡ªå·±ä½ç½®æ¨å®šæ–¹å¼
- **VIO (Visual-Inertial Odometry)**: ã‚«ãƒ¡ãƒ©ç”»åƒ + IMUï¼ˆåŠ é€Ÿåº¦è¨ˆãƒ»ã‚¸ãƒ£ã‚¤ãƒ­ã‚¹ã‚³ãƒ¼ãƒ—ï¼‰
- **ç‰¹å¾´ç‚¹è¿½è·¡**: ç’°å¢ƒã®ç‰¹å¾´ç‚¹ã‚’è¿½è·¡ã—ã¦ã‚«ãƒ¡ãƒ©ç§»å‹•ã‚’æ¨å®š
- **IMUç©åˆ†**: æ…£æ€§ã‚»ãƒ³ã‚µãƒ¼ã§çŸ­æœŸé–“ã®å‹•ãã‚’è£œå®Œ
- **ãƒ‰ãƒªãƒ•ãƒˆè£œæ­£**: ãƒ«ãƒ¼ãƒ—ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã§ç´¯ç©èª¤å·®ã‚’ä¿®æ­£

### å®Ÿæ¸¬å€¤ï¼ˆ1611626eã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰
```
ãƒ•ãƒ¬ãƒ¼ãƒ æ•°: 209
Xç¯„å›²: [-0.025, 3.802]m  (æ°´å¹³ç§»å‹•: ç´„3.8m)
Yç¯„å›²: [-0.239, 0.188]m  (é«˜ã•å¤‰å‹•: ç´„0.4m) â† é‡åŠ›æ–¹å‘
Zç¯„å›²: [-1.857, 1.261]m  (å‰å¾Œç§»å‹•: ç´„3.1m)
é–‹å§‹ä½ç½®: (0.220, 0.077, 0.098)  â† ã»ã¼åŸç‚¹
```

### åˆ©ç‚¹
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ï¼ˆ30-60fpsï¼‰
- é‡åŠ›æ–¹å‘ãŒæ­£ç¢ºï¼ˆIMUã«ã‚ˆã‚Šï¼‰
- ç«¯æœ«ã®ã¿ã§å®Œçµ
- ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·

### æ¬ ç‚¹
- é•·æ™‚é–“ã§ãƒ‰ãƒªãƒ•ãƒˆè“„ç©
- ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®å°‘ãªã„ç’°å¢ƒã§ç²¾åº¦ä½ä¸‹

---

## 2. COLMAPåº§æ¨™ç³»

### ç‰¹å¾´
- **åŸç‚¹**: ä»»æ„ï¼ˆæœ€åˆã®ç”»åƒã¾ãŸã¯æœ€é©åŒ–çµæœã«ã‚ˆã‚‹ï¼‰
- **è»¸æ–¹å‘**: é‡åŠ›æ–¹å‘ã¨ã®é–¢ä¿‚ã¯ä¿è¨¼ã•ã‚Œãªã„
- **ã‚¹ã‚±ãƒ¼ãƒ«**: Structure from Motion (SfM) ã§ã¯ç›¸å¯¾ã‚¹ã‚±ãƒ¼ãƒ«ã®ã¿
- **å˜ä½**: ä»»æ„ï¼ˆå¤–éƒ¨æƒ…å ±ãŒãªã„ã¨ãƒ¡ãƒ¼ãƒˆãƒ«å˜ä½ã«ãªã‚‰ãªã„ï¼‰

### è‡ªå·±ä½ç½®æ¨å®šæ–¹å¼
- **SfM (Structure from Motion)**: ç”»åƒã®ã¿ã‹ã‚‰3Dæ§‹é€ ã¨ã‚«ãƒ¡ãƒ©ä½ç½®ã‚’åŒæ™‚æ¨å®š
- **ç‰¹å¾´ç‚¹æ¤œå‡º**: SIFTç­‰ã§ç”»åƒã‹ã‚‰ç‰¹å¾´ç‚¹ã‚’æŠ½å‡º
- **ç‰¹å¾´ç‚¹ãƒãƒƒãƒãƒ³ã‚°**: ç”»åƒé–“ã§å¯¾å¿œç‚¹ã‚’è¦‹ã¤ã‘ã‚‹
- **ãƒãƒ³ãƒ‰ãƒ«èª¿æ•´**: å…¨ã‚«ãƒ¡ãƒ©ãƒ»å…¨3Dç‚¹ã‚’åŒæ™‚æœ€é©åŒ–

### å®Ÿæ¸¬å€¤ï¼ˆ1611626eã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰
```
ç™»éŒ²ç”»åƒæ•°: 164 (209æšä¸­ã€78%ãŒç™»éŒ²æˆåŠŸ)
Xç¯„å›²: [-4.077, 1.199]m
Yç¯„å›²: [-3.359, 2.893]m
Zç¯„å›²: [-4.792, 5.069]m
```

### åˆ©ç‚¹
- é«˜ç²¾åº¦ãªç›¸å¯¾ä½ç½®
- ç”»åƒã®ã¿ã§å‹•ä½œï¼ˆIMUä¸è¦ï¼‰
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æœ€é©åŒ–ã§ä¸€è²«æ€§ãŒé«˜ã„

### æ¬ ç‚¹
- å‡¦ç†æ™‚é–“ãŒé•·ã„ï¼ˆæ•°åˆ†ã€œæ•°ååˆ†ï¼‰
- çµ¶å¯¾ã‚¹ã‚±ãƒ¼ãƒ«ãŒä¸æ˜
- é‡åŠ›æ–¹å‘ãŒä¸æ˜
- ç‰¹å¾´ç‚¹ä¸è¶³ã§å¤±æ•—ã—ã‚„ã™ã„

---

## 3. åº§æ¨™ç³»ã®é•ã„ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒï¼‰

| é …ç›® | ARCore | COLMAP |
|------|--------|--------|
| åŸç‚¹ | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ä½ç½® | æœ€é©åŒ–çµæœã«ã‚ˆã‚‹ |
| Yè»¸ | é‡åŠ›æ–¹å‘ï¼ˆä¸ŠãŒæ­£ï¼‰ | ä¸å®š |
| ã‚¹ã‚±ãƒ¼ãƒ« | ãƒ¡ãƒ¼ãƒˆãƒ«ï¼ˆå®Ÿå¯¸ï¼‰ | ç›¸å¯¾ï¼ˆä¸å®šï¼‰ |
| ç§»å‹•ç¯„å›²X | 3.8m | 5.3m |
| ç§»å‹•ç¯„å›²Y | 0.4m | 6.3m |
| ç§»å‹•ç¯„å›²Z | 3.1m | 9.9m |

### å›³è§£

```
ARCoreåº§æ¨™ç³»:
      Y (ä¸Š)
      |
      |
      +------ X (å³)
     /
    Z (å¾Œã‚)
    
    * é‡åŠ›æ–¹å‘ãŒå¸¸ã«Yè»¸è² æ–¹å‘
    * ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ä½ç½®ãŒåŸç‚¹

COLMAPåº§æ¨™ç³»:
    ? 
    |
    |
    +------ ?
   /
  ?
  
  * è»¸æ–¹å‘ã¯æœ€é©åŒ–çµæœã«ä¾å­˜
  * ã‚¹ã‚±ãƒ¼ãƒ«ã‚‚ä¸å®š
```

---

## 4. åº§æ¨™ç³»çµ±åˆã®æ–¹æ³•

### æ–¹æ³•1: ARCoreãƒãƒ¼ã‚ºã‚’COLMAPã«æä¾›ï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰
1. ARCoreã®ç”»åƒã¨ãƒãƒ¼ã‚ºã‚’COLMAPã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
2. COLMAPã®SfMã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã€ARCoreãƒãƒ¼ã‚ºã‚’åˆæœŸå€¤ã¨ã—ã¦ä½¿ç”¨
3. Dense MVSï¼ˆPatch Match Stereoï¼‰ã§æ·±åº¦æ¨å®š
4. çµæœã¯ARCoreåº§æ¨™ç³»ã«è¿‘ã„

**å•é¡Œç‚¹**: COLMAPã®SfMã¯ç‹¬è‡ªã«æœ€é©åŒ–ã™ã‚‹ãŸã‚ã€ARCoreãƒãƒ¼ã‚ºã¨ä¹–é›¢ã™ã‚‹å¯èƒ½æ€§

### æ–¹æ³•2: åº§æ¨™å¤‰æ›è¡Œåˆ—ã‚’è¨ˆç®—
1. ä¸¡æ–¹ã®åº§æ¨™ç³»ã§ã‚«ãƒ¡ãƒ©ä½ç½®ã‚’å–å¾—
2. å¯¾å¿œç‚¹ã‹ã‚‰Rigid Transformationï¼ˆå›è»¢+ä¸¦é€²+ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰ã‚’è¨ˆç®—
3. COLMAPçµæœã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›

```python
# Procrustesåˆ†æã§å¤‰æ›è¡Œåˆ—ã‚’è¨ˆç®—
from scipy.spatial import procrustes
mtx1, mtx2, disparity = procrustes(arcore_positions, colmap_positions)
```

### æ–¹æ³•3: RGBDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆARCore Depthä½¿ç”¨ï¼‰
1. ARCoreã®RGBç”»åƒ + Depthç”»åƒã‚’ä½¿ç”¨
2. ARCoreãƒãƒ¼ã‚ºã§TSDFçµ±åˆ
3. çµæœã¯å®Œå…¨ã«ARCoreåº§æ¨™ç³»

**åˆ©ç‚¹**: åº§æ¨™ç³»ã®å•é¡ŒãŒãªã„ã€RFIDã‚¿ã‚°ä½ç½®ãŒæ­£ç¢º

---

## 5. RFIDã‚¿ã‚°ä½ç½®ã®æ‰±ã„

### RFIDã‚¿ã‚°æ¤œå‡ºã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```json
{
  "detections": [
    {
      "tag_id": "E280...",
      "timestamp": 1234567890,
      "rssi": -45,
      "frame_index": 100,
      "camera_position": {"x": 1.5, "y": 0.1, "z": -0.5}
    }
  ]
}
```

### åº§æ¨™ç³»ã®é‡è¦æ€§
- `camera_position`ã¯ARCoreåº§æ¨™ç³»ã§è¨˜éŒ²ã•ã‚Œã‚‹
- ç‚¹ç¾¤/ãƒ¡ãƒƒã‚·ãƒ¥ã‚‚ARCoreåº§æ¨™ç³»ã§ã‚ã‚Œã°ã‚¿ã‚°ä½ç½®ãŒæ­£ç¢ºã«è¡¨ç¤ºå¯èƒ½
- COLMAPåº§æ¨™ç³»ã®å ´åˆã€å¤‰æ›ãŒå¿…è¦

---

## 6. æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### ã‚±ãƒ¼ã‚¹1: ARCore Depth APIãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆ
**â†’ RGBDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’ä½¿ç”¨**
- åº§æ¨™ç³»å¤‰æ›ãŒä¸è¦
- é«˜å¯†åº¦ãªç‚¹ç¾¤
- RFIDã‚¿ã‚°ä½ç½®ãŒæ­£ç¢º

### ã‚±ãƒ¼ã‚¹2: ARCore Depth APIãŒåˆ©ç”¨ä¸å¯ã®å ´åˆ
**â†’ COLMAP MVS + åº§æ¨™å¤‰æ›**
1. COLMAPã§3Då†æ§‹æˆ
2. ARCore-COLMAPé–“ã®åº§æ¨™å¤‰æ›è¡Œåˆ—ã‚’è¨ˆç®—
3. çµæœã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›
4. RFIDã‚¿ã‚°ä½ç½®ã¨çµ±åˆ

---

## 7. å®Ÿãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹åº§æ¨™ç³»å¯¾å¿œåˆ†æ

### è»¸ã®å¯¾å¿œé–¢ä¿‚ï¼ˆç›¸é–¢åˆ†æçµæœï¼‰
```
ARCore X â†” COLMAP Z: ç›¸é–¢ = 0.984  â˜…å¼·ã„æ­£ã®ç›¸é–¢
ARCore X â†” COLMAP Y: ç›¸é–¢ = -0.953 â˜…å¼·ã„è² ã®ç›¸é–¢
ARCore Z â†” COLMAP Y: ç›¸é–¢ = 0.954  â˜…å¼·ã„æ­£ã®ç›¸é–¢
ARCore Z â†” COLMAP Z: ç›¸é–¢ = -0.914 â˜…å¼·ã„è² ã®ç›¸é–¢
```

### åº§æ¨™è»¸ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆæ¨å®šï¼‰
| ARCore | COLMAP | é–¢ä¿‚ |
|--------|--------|------|
| X (å³) | Z (?) | æ­£ã®ç›¸é–¢ |
| Y (ä¸Š) | ? | å¼±ã„ç›¸é–¢ |
| Z (å¾Œ) | Y (?) | æ­£ã®ç›¸é–¢ |

### ã‚¹ã‚±ãƒ¼ãƒ«ã®é•ã„
```
ç§»å‹•ç¯„å›²:
  ARCore: X=3.79m, Y=0.40m, Z=2.92m â†’ ç·è·é›¢ 4.80m
  COLMAP: X=5.28m, Y=6.25m, Z=9.86m â†’ ç·è·é›¢ 12.81m

ã‚¹ã‚±ãƒ¼ãƒ«æ¯”: COLMAP / ARCore = 2.67å€
```

**é‡è¦**: COLMAPã®åº§æ¨™ç³»ã¯ARCoreã®ç´„2.7å€ã«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹

### ã‚«ãƒ¡ãƒ©ä½ç½®ã®ä¾‹
| ç”»åƒ | ARCore (X,Y,Z) | COLMAP (X,Y,Z) |
|------|----------------|----------------|
| frame_176359... | (0.22, 0.08, 0.10) | (-1.92, 1.41, -3.35) |
| frame_176360... | (0.23, 0.09, 0.16) | (-1.80, 1.44, -3.43) |

### åº§æ¨™å¤‰æ›ã®å¿…è¦æ€§
COLMAPã®çµæœã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›ã™ã‚‹ã«ã¯ï¼š
1. **å›è»¢**: è»¸ã®å…¥ã‚Œæ›¿ãˆ + ç¬¦å·åè»¢
2. **ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**: ç´„0.37å€ (1/2.67)
3. **ä¸¦é€²**: ã‚ªãƒ•ã‚»ãƒƒãƒˆèª¿æ•´

---

## 8. ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†æ

### backup/pointcloud.ply ã®ç‰¹å¾´
```
ç‚¹æ•°: 240,432
ç¯„å›²: X=[-3, 3]m, Y=[-3, 3]m, Z=[-3, 3]m
åŸç‚¹ã‹ã‚‰ã®æœ€å¤§è·é›¢: 3.00m
```
â†’ **åŸç‚¹ã‹ã‚‰3mä»¥å†…ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿**
â†’ åº§æ¨™ç³»ã¯æ­£è¦åŒ–ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„

### å•é¡Œç‚¹
1. COLMAPã®ã‚¹ã‚±ãƒ¼ãƒ«ãŒARCoreã¨ç•°ãªã‚‹ï¼ˆç´„2.7å€ï¼‰
2. è»¸ã®å‘ãã‚‚ç•°ãªã‚‹ï¼ˆå›è»¢ãŒå¿…è¦ï¼‰
3. RFIDã‚¿ã‚°ä½ç½®ã¯ARCoreåº§æ¨™ç³»ã§è¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹

---

## 9. æ¨å¥¨ã•ã‚Œã‚‹è§£æ±ºç­–

### è§£æ±ºç­–A: ARCoreåº§æ¨™ç³»ã§COLMAPã‚’å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
1. COLMAPã«ARCoreãƒãƒ¼ã‚ºã‚’åˆæœŸå€¤ã¨ã—ã¦ä¸ãˆã‚‹
2. ãƒãƒ³ãƒ‰ãƒ«èª¿æ•´ã§æœ€é©åŒ–ã—ã¤ã¤ã€ã‚¹ã‚±ãƒ¼ãƒ«ã‚’å›ºå®š
3. çµæœãŒARCoreåº§æ¨™ç³»ã«è¿‘ããªã‚‹

### è§£æ±ºç­–B: åº§æ¨™å¤‰æ›è¡Œåˆ—ã‚’è¨ˆç®—
```python
# Procrustesåˆ†æã§å¤‰æ›ã‚’è¨ˆç®—
from scipy.linalg import orthogonal_procrustes

# ARCoreã¨COLMAPã®å¯¾å¿œç‚¹
arcore_pts = np.array([...])  # (N, 3)
colmap_pts = np.array([...])  # (N, 3)

# ä¸­å¿ƒåŒ–
arcore_centered = arcore_pts - arcore_pts.mean(axis=0)
colmap_centered = colmap_pts - colmap_pts.mean(axis=0)

# æœ€é©å›è»¢è¡Œåˆ—
R, _ = orthogonal_procrustes(colmap_centered, arcore_centered)

# ã‚¹ã‚±ãƒ¼ãƒ«
scale = np.linalg.norm(arcore_centered) / np.linalg.norm(colmap_centered)

# å¤‰æ›é©ç”¨
colmap_transformed = scale * (colmap_pts @ R) + offset
```

### è§£æ±ºç­–C: RGBDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½¿ç”¨ï¼ˆæœ€ã‚‚ç°¡å˜ï¼‰
- ARCore Depth APIã‚’ä½¿ç”¨
- åº§æ¨™ç³»å¤‰æ›ãŒä¸è¦
- RFIDã‚¿ã‚°ä½ç½®ã¨å®Œå…¨ã«ä¸€è‡´

---

## 10. å®Ÿè£…æ¸ˆã¿: COLMAP â†” ARCore ãƒãƒ¼ã‚ºç´ã¥ã‘

### ç´ã¥ã‘ã®ä»•çµ„ã¿

COLMAPã¨ARCoreã®ã‚«ãƒ¡ãƒ©ãƒãƒ¼ã‚ºã¯ã€**ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«å**ã§ç´ã¥ã‘ã‚‰ã‚Œã¾ã™ã€‚

```
ARCoreãƒ‡ãƒ¼ã‚¿                          COLMAPãƒ‡ãƒ¼ã‚¿
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ARCore_sensor_pose.txt                colmap/sparse/0/images.bin
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
frame_176359940065365.jpg             frame_176359940065365.jpg
  â†’ ARCore pose (tx, ty, tz, qw...)     â†’ COLMAP pose (tx', ty', tz', qw'...)
frame_176360140068874.jpg             frame_176360140068874.jpg
  â†’ ARCore pose                          â†’ COLMAP pose
...                                    ...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨ˆç®— (`_compute_colmap_to_arcore_transform`)

```python
def _compute_colmap_to_arcore_transform(parser, colmap_dir):
    # 1. ARCoreã‚«ãƒ¡ãƒ©ä½ç½®ã‚’å–å¾—
    arcore_data = {}
    for frame in parser.frames:
        if frame.pose and frame.image_path:
            pose_matrix = frame.pose.to_matrix()
            position = pose_matrix[:3, 3]
            arcore_data[frame.image_path.name] = position
    
    # 2. COLMAPã‚«ãƒ¡ãƒ©ä½ç½®ã‚’å–å¾—ï¼ˆimages.binï¼‰
    colmap_data = read_colmap_images(colmap_dir / "sparse/0")
    
    # 3. å…±é€šç”»åƒã§Procrustesåˆ†æ
    common_images = set(arcore_data.keys()) & set(colmap_data.keys())
    
    arcore_pts = np.array([arcore_data[img] for img in common_images])
    colmap_pts = np.array([colmap_data[img] for img in common_images])
    
    # 4. ä¸­å¿ƒåŒ–
    arcore_centroid = arcore_pts.mean(axis=0)
    colmap_centroid = colmap_pts.mean(axis=0)
    
    # 5. ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—
    scale = arcore_scale / colmap_scale  # å…¸å‹å€¤: ~0.4
    
    # 6. æœ€é©å›è»¢è¡Œåˆ—
    R, _ = orthogonal_procrustes(colmap_normalized, arcore_normalized)
    
    return {
        'scale': scale,
        'rotation': R,
        'colmap_centroid': colmap_centroid,
        'arcore_centroid': arcore_centroid
    }
```

### ç‚¹ç¾¤ã®å¤‰æ›

```python
def _transform_points_to_arcore(points, transform):
    """COLMAPåº§æ¨™ç³»ã®ç‚¹ç¾¤ã‚’ARCoreåº§æ¨™ç³»ã«å¤‰æ›"""
    scale = transform['scale']
    R = transform['rotation']
    colmap_centroid = transform['colmap_centroid']
    arcore_centroid = transform['arcore_centroid']
    
    # å¤‰æ›å¼:
    # p_arcore = scale Ã— R Ã— (p_colmap - colmap_centroid) + arcore_centroid
    centered = points - colmap_centroid
    transformed = scale * (centered @ R) + arcore_centroid
    return transformed
```

### å¤‰æ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ä¾‹ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ï¼‰

`colmap_to_arcore_transform.json`:
```json
{
    "scale": 0.4124,
    "rotation": [
        [0.498, 0.107, 0.861],
        [-0.363, -0.876, 0.318],
        [0.788, -0.471, -0.397]
    ],
    "colmap_centroid": [-0.129, -0.074, 0.034],
    "arcore_centroid": [2.083, 0.014, -0.079]
}
```

---

## 11. RFIDã‚¿ã‚°ã®åº§æ¨™ã«ã¤ã„ã¦

### é‡è¦: RFIDã¯å¤‰æ›ä¸è¦

RFIDã‚¿ã‚°ã®ä½ç½®ã¯**æœ€åˆã‹ã‚‰ARCoreåº§æ¨™ç³»**ã§è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Androidç«¯æœ«]                                               â”‚
â”‚       â”‚                                                     â”‚
â”‚       â”œâ”€â†’ ARCore VIO â”€â†’ ã‚«ãƒ¡ãƒ©ä½ç½® (ARCoreåº§æ¨™)             â”‚
â”‚       â”‚                        â”‚                            â”‚
â”‚       â”‚                        â–¼                            â”‚
â”‚       â”‚                 RFIDæ¤œå‡ºæ™‚ã®ä½ç½®                     â”‚
â”‚       â”‚                        â”‚                            â”‚
â”‚       â”‚                        â–¼                            â”‚
â”‚       â”‚                 rfid_detections.json                â”‚
â”‚       â”‚                 (ARCoreåº§æ¨™ç³»)                       â”‚
â”‚       â”‚                                                     â”‚
â”‚       â””â”€â†’ ç”»åƒæ’®å½± â”€â†’ COLMAPå‡¦ç† â”€â†’ ãƒ¡ãƒƒã‚·ãƒ¥               â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚                     Procrusteså¤‰æ›                          â”‚
â”‚                              â”‚                              â”‚
â”‚                              â–¼                              â”‚
â”‚                     mesh.ply (ARCoreåº§æ¨™ç³»)                 â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœ€çµ‚å‡ºåŠ›ï¼ˆã™ã¹ã¦ARCoreåº§æ¨™ç³»ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ« | åº§æ¨™ç³» | å¤‰æ› |
|----------|--------|------|
| `mesh.ply` | ARCore | COLMAP â†’ ARCoreå¤‰æ›æ¸ˆã¿ |
| `point_cloud.ply` | ARCore | COLMAP â†’ ARCoreå¤‰æ›æ¸ˆã¿ |
| `trajectory.json` | ARCore | å…ƒã€…ARCoreåº§æ¨™ |
| `rfid_positions.json` | ARCore | å…ƒã€…ARCoreåº§æ¨™ï¼ˆå¤‰æ›ä¸è¦ï¼‰|

### Viewerã§ã®è¡¨ç¤º

```javascript
// viewer.html ã§ã®åº§æ¨™å‡¦ç†

// 1. ãƒ¡ãƒƒã‚·ãƒ¥èª­ã¿è¾¼ã¿æ™‚: ä¸­å¿ƒã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—ãƒ»ä¿å­˜
const boundingBox = new THREE.Box3().setFromObject(mesh);
sceneCenterOffset = boundingBox.getCenter(new THREE.Vector3());
mesh.position.sub(sceneCenterOffset);

// 2. è»Œè·¡èª­ã¿è¾¼ã¿æ™‚: åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨
trajectory.forEach(pose => {
    marker.position.set(
        pose.x - sceneCenterOffset.x,
        pose.y - sceneCenterOffset.y,
        pose.z - sceneCenterOffset.z
    );
});

// 3. RFIDèª­ã¿è¾¼ã¿æ™‚: åŒã˜ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨
rfidMarker.position.set(
    pos.x - sceneCenterOffset.x,
    pos.y - sceneCenterOffset.y,
    pos.z - sceneCenterOffset.z
);
```

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¡ãƒƒã‚·ãƒ¥ãƒ»è»Œè·¡ãƒ»RFIDãŒã™ã¹ã¦ã‚°ãƒªãƒƒãƒ‰ä¸­å¿ƒã§çµ±ä¸€è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

---

## 12. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. ~~**è§£æ±ºç­–ã®é¸æŠ**: RGBDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒåˆ©ç”¨å¯èƒ½ãªã‚‰ãã‚Œã‚’ä½¿ç”¨~~ â†’ MVS + åº§æ¨™å¤‰æ›ã‚’å®Ÿè£…æ¸ˆã¿
2. ~~**åº§æ¨™å¤‰æ›ã®å®Ÿè£…**: MVSä½¿ç”¨æ™‚ã¯å¤‰æ›è¡Œåˆ—ã‚’è¨ˆç®—~~ â†’ Procrustesåˆ†æã§å®Ÿè£…æ¸ˆã¿
3. **RFIDã‚¿ã‚°ä½ç½®ã®æ¤œè¨¼**: Viewerã§ã‚¿ã‚°ä½ç½®ãŒæ­£ã—ã„ã‹ç¢ºèªï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ï¼‰
4. **è·é›¢ãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨**: ã‚«ãƒ¡ãƒ©ã‹ã‚‰3mä»¥å†…ã®ç‚¹ç¾¤ã‚’æŠ½å‡ºï¼ˆconfig.yamlã§è¨­å®šå¯èƒ½ï¼‰

---

## å‚è€ƒè³‡æ–™

- [ARCore Coordinate System](https://developers.google.com/ar/develop/fundamentals)
- [COLMAP Documentation](https://colmap.github.io/)
- [Open3D Coordinate System](http://www.open3d.org/docs/)
- [Procrustes Analysis (scipy)](https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.orthogonal_procrustes.html)

---
æœ€çµ‚æ›´æ–°: 2026-01-09

